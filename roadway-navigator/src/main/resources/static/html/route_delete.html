<style>
    .col-md-8 {
      background-color: white;
    }
    tr.disabled {
        color: silver;
        background-color: darkmagenta;
    }

        tr.disabled:hover {
            color: silver !important;
            background-color: darkmagenta !important;
        }
</style>
<form>
    <div class="container">
        <div class="row">
            <div class="col-md-8">
                <table data-toggle="table" class="table" id="table">
                    <thead class="bg-primary">
                    <tr>
                        <th data-field="id">编号</th>
                        <th data-field="path" data-sortable="true">路径</th>
                        <th data-field="url" data-sortable="true">调用地址</th>
                        <th data-formatter="deleteFormatter" data-events="operateEvents">
                            删除
                        </th>
                        <th data-formatter="enableFormatter" data-events="operateEvents">
                            停用/启用
                        </th>
                    </tr>
                    </thead>
                </table>
                <div class="alert alert-danger"></div>
                <div class="alert alert-info"></div>
            </div>
        </div>
    </div>
</form>
<script>
    window.onload = function () {
        if (!window.$ || !window.custom)
            window.location.replace("login.html");
    }
   var $table = $('#table');


    var deleteFormatter = function (value, row, index) {
        return [
            '<a class="remove" href="javascript:void(0)" title="删除">',
            '<i class="fa fa-trash fa-2x"></i>',
            '</a>  '
        ].join('');
    }

    var enableFormatter = function (value, row, index) {
        if (row.enabled) {
            return [
                '<a class="enable" href="javascript:void(0)" title="停用">',
                '<i class="fa fa-thumbs-up fa-2x"></i>',
                '</a>  '
            ].join('');
        }
        else {
            return [
                '<a class="enable" href="javascript:void(0)" title="启用">',
                '<i class="fa fa-thumbs-down fa-2x"></i>',
                '</a>  '
            ].join('');
        }
    }


    var operateEvents = {
        'click .remove': function (e, value, row, index) {
            del(row.id);
        },
       'click .enable': function (e, value, row, index) {
            enable(index, row,!row.enabled);
        },
    }

   function enable(index, route, enabled) {
        $(".alert").hide();
        $.postForm({
            url: "/api/roadway/route/enable",
            contentType: "application/json",
            data: route,
            modify: function(data) {
                data.enabled = enabled;
                return data;
            },
            success: function (data) {
                if(data.code === 601) {
                     window.location.replace("login.html");
                     return;
                }
                if (data.code == 200) {
                    $(".alert-info").html((enabled? "启用" : "停用") + "成功").show();
                    $table.bootstrapTable('updateCell', {index: index, field: 'enabled', value: enabled})
                } else {
                    $(".alert-danger").html((enabled? "启用" : "停用") + "失败," + data.message).show();
                }
            },
            error: function (x, s, t) {
                $(".alert-danger").html(x.responseText).show();
            }
        })
    }

    function del(id) {
        $(".alert").hide();
        $.postForm({
            url: "/api/roadway/route/delete",
            data: {
                id: id
            },
            success: function (data) {
                if(data.code === 601) {
                     window.location.replace("login.html");
                     return;
                }
                if (data.code === 200) {
                    $(".alert-info").html(data.message).show();
                    $table.bootstrapTable('remove', {
                        field: 'id',
                        values: [id]
                    });
                } else {
                    $(".alert-danger").html(data.message).show();
                }
            },
            error: function (x, s, t) {
                $(".alert-danger").html(x.responseText).show();
            }
        })
    }

    function list() {
      $(".alert").hide();
        $.postForm({
            url: "/api/roadway/route/list",
            success: function (data) {
                if(data.code === 601) {
                     window.location.replace("login.html");
                     return;
                }
                if(data.code !== 200) {
                     $(".alert-danger").html(data.message).show();
                     return;
                }
                $table.bootstrapTable({
                    data: data.data,
                    pagination: true,
                    search: true,
                    rowAttributes: function (row, index) {
                        if (!row.enabled) {
                            return { "class": "disabled" };
                        }
                    }
                })
            },
            error: function (x, s, t) {
               $(".alert-danger").html(x.responseText).show();
            }
        })
    }

    $(document).ready(function () {
        list();
    })
</script>
